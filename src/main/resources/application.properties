spring.application.name=wallet

# Conexão com Banco (usar variáveis de ambiente)
# IMPORTANTE: Para produção, SEMPRE defina DB_USER e DB_PASSWORD como ENV VARS
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/wallet_db}
spring.datasource.username=${DB_USER:wallet_user}
spring.datasource.password=${DB_PASSWORD:changeme_in_production}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / Hibernate (Configurações para Dev)
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ========== LOGS SQL DETALHADOS (Ver FOR UPDATE) ==========
logging.level.org.hibernate.SQL=${HIBERNATE_SQL_LOG_LEVEL:DEBUG}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${HIBERNATE_BINDER_LOG_LEVEL:TRACE}

# Configuração de logging para produção (evitar logs sensíveis)
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n
logging.level.com.wallet.wallet=INFO

server.port=${SERVER_PORT:8081}

# ========== SPRING BOOT ACTUATOR ==========
# Expor endpoints de saúde para monitoramento e healthchecks
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true

# ========== RESILIENCE4J: CIRCUIT BREAKER ==========
# Circuit Breaker para o autorizador externo
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.register-health-indicator=true
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.sliding-window-size=10
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.wait-duration-in-open-state=30000
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.slow-call-rate-threshold=100
resilience4j.circuitbreaker.instances.authorizerCircuitBreaker.slow-call-duration-threshold=2000

# ========== RESILIENCE4J: RETRY ==========
# Retry para o autorizador externo com backoff exponencial
resilience4j.retry.instances.authorizerRetry.max-attempts=3
resilience4j.retry.instances.authorizerRetry.wait-duration=100
resilience4j.retry.instances.authorizerRetry.exponential-backoff-multiplier=2.0
resilience4j.retry.instances.authorizerRetry.retry-exceptions=java.net.ConnectException,java.net.SocketTimeoutException,org.springframework.web.client.ResourceAccessException
